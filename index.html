<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NCCAA Lumbini Cadet System</title>
    <script src="https://accounts.google.com/gsi/client"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        olive: {
                            50: '#f6f6e9',
                            100: '#eaeac7',
                            200: '#d5d5a1',
                            300: '#bdbd7a',
                            400: '#a3a35a',
                            500: '#808000',
                            600: '#6e6e00',
                            700: '#5c5c00',
                            800: '#4a4a00',
                            900: '#383800',
                        },
                    },
                    boxShadow: {
                        'soft': '0 4px 20px rgba(0, 0, 0, 0.08)',
                        'elevated': '0 8px 30px rgba(0, 0, 0, 0.12)',
                    }
                },
            },
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .loader {
            border-top-color: #808000;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .sidebar-collapsed .nav-text {
            display: none !important;
        }

        .sidebar-collapsed .text-lg {
            display: none !important;
        }

        .sidebar-collapsed {
            width: 5rem !important;
        }

        .stat-card {
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
        }

        .btn-primary {
            background: linear-gradient(135deg, #808000, #6e6e00);
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #6e6e00, #5c5c00);
            box-shadow: 0 4px 12px rgba(128, 128, 0, 0.3);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #4a4a00, #383800);
            transition: all 0.3s ease;
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #383800, #2a2a00);
            box-shadow: 0 4px 12px rgba(74, 74, 0, 0.3);
        }

        .nav-item {
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-item.active {
            background: rgba(255, 255, 255, 0.15);
        }

        .nav-item.active::after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background: white;
        }

        @media (max-width: 768px) {
            #sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            #sidebar.open {
                transform: translateX(0);
            }

            #app {
                margin-left: 0 !important;
            }

            #mobileMenuBtn {
                display: block;
            }
        }

        .sidebar-collapsed .lang-text,
        .sidebar-collapsed .logout-text {
            display: none !important;
        }

        .sidebar-collapsed .lang-btn,
        .sidebar-collapsed .logout-btn {
            justify-content: center;
            padding-left: 0 !important;
            padding-right: 0 !important;
        }

        .sidebar-collapsed .sidebar-footer {
            align-items: center;
        }
    </style>
</head>

<body class="bg-gradient-to-br from-olive-50 to-olive-200 min-h-screen font-sans">
    <!-- Login Screen -->
    <div id="loginScreen" class="flex items-center justify-center min-h-screen">
        <div
            class="bg-white/95 p-10 rounded-2xl shadow-xl w-full max-w-md flex flex-col items-center border border-olive-300">
            <div class="bg-olive-100 p-4 rounded-full mb-6 shadow-inner">
                <img src="images/1.png" alt="NCC Logo" class="rounded-full border-4 border-olive-600">
            </div>
            <h1 class="text-3xl font-bold text-olive-800 mb-2 tracking-tight text-center">NCCAA Lumbini Cadet System
            </h1>
            <p class="text-olive-600 mb-8 text-center font-medium">सुरक्षित क्याडेट दर्ता प्रणाली</p>
            <div class="w-full mb-6">
                <div id="g_id_onload"
                    data-client_id="548742514555-37emngrrulr97jc4spf3a4if8njootvc.apps.googleusercontent.com"
                    data-callback="handleLogin">
                </div>
                <div class="g_id_signin w-full" data-type="standard" data-size="large" data-theme="filled_blue"
                    data-text="sign_in_with" data-shape="rectangular" data-logo_alignment="center">
                </div>
            </div>
            <p class="text-sm text-olive-500 text-center">Restricted access for NCCAA administrators only</p>
        </div>
    </div>

    <!-- App Container (hidden until login) -->
    <div id="appContainer" class="hidden">
        <!-- Mobile Menu Button -->
        <button id="mobileMenuBtn"
            class="md:hidden fixed top-4 left-4 z-50 bg-olive-700 text-white p-3 rounded-full shadow-lg">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Sidebar -->
        <aside id="sidebar"
            class="fixed top-0 left-0 h-full w-64 bg-olive-700 text-olive-50 flex flex-col z-50 shadow-xl transition-all duration-300">
            <div class="flex flex-col items-center py-6 border-b border-olive-600">
                <img src="images/1.png" alt="NCC Logo" class="w-16 h-16 rounded-full border-2 border-white mb-2">
                <span class="text-lg font-bold text-olive-50 mb-2">NCCAA</span>
                <button id="sidebarToggle" class="text-olive-200 hover:text-white mt-2">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
            <nav class="flex-1 px-2 py-4 space-y-1">
                <button onclick="showScreen('dashboard')"
                    class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg transition font-medium text-olive-50 active">
                    <span class="nav-icon"><i class="fas fa-home"></i></span>
                    <span class="nav-text" lang="en">Dashboard</span>
                    <span class="nav-text hidden" lang="np">ड्यासबोर्ड</span>
                </button>
                <button onclick="showScreen('addCadet')"
                    class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg transition font-medium text-olive-50">
                    <span class="nav-icon"><i class="fas fa-user-plus"></i></span>
                    <span class="nav-text" lang="en">Add Cadet</span>
                    <span class="nav-text hidden" lang="np">क्याडेट थप्नुहोस्</span>
                </button>
                <button onclick="showScreen('viewCadets')"
                    class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg transition font-medium text-olive-50">
                    <span class="nav-icon"><i class="fas fa-users"></i></span>
                    <span class="nav-text" lang="en">View Cadets</span>
                    <span class="nav-text hidden" lang="np">क्याडेट सूची</span>
                </button>
                <button onclick="showScreen('reports')"
                    class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg transition font-medium text-olive-50">
                    <span class="nav-icon"><i class="fas fa-chart-bar"></i></span>
                    <span class="nav-text" lang="en">Reports</span>
                    <span class="nav-text hidden" lang="np">रिपोर्टहरू</span>
                </button>
                <button onclick="showScreen('settings')"
                    class="nav-item w-full flex items-center gap-3 px-4 py-3 rounded-lg transition font-medium text-olive-50">
                    <span class="nav-icon"><i class="fas fa-cog"></i></span>
                    <span class="nav-text" lang="en">Settings</span>
                    <span class="nav-text hidden" lang="np">सेटिङहरू</span>
                </button>
            </nav>
            <div class="sidebar-footer px-4 py-4 border-t border-olive-600 flex flex-col gap-2">
                <div class="flex gap-2 mb-3">
                    <button onclick="switchLanguage('en')"
                        class="lang-btn flex-1 px-3 py-2 bg-white text-olive-700 rounded-lg font-semibold shadow hover:bg-olive-100 transition flex items-center justify-center gap-2">
                        <i class="fas fa-language"></i>
                        <span class="lang-text">EN</span>
                    </button>
                    <button onclick="switchLanguage('np')"
                        class="lang-btn flex-1 px-3 py-2 bg-white text-olive-700 rounded-lg font-semibold shadow hover:bg-olive-100 transition flex items-center justify-center gap-2">
                        <i class="fas fa-language"></i>
                        <span class="lang-text">ने</span>
                    </button>
                </div>
                <button onclick="logout()"
                    class="logout-btn px-4 py-2 bg-red-600 hover:bg-red-700 rounded-lg font-semibold shadow transition flex items-center justify-center gap-2">
                    <i class="fas fa-sign-out-alt"></i>
                    <span class="logout-text" lang="en">Logout</span>
                    <span class="logout-text hidden" lang="np">लगआउट</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <div id="app" class="ml-64 min-h-screen">
            <!-- Top Bar -->
            <div class="bg-white shadow-sm py-4 px-6 flex justify-between items-center">
                <div>
                    <h2 id="screenTitle" class="text-xl font-bold text-olive-800">Dashboard</h2>
                </div>
                <div class="flex items-center gap-4">
                    <div class="flex items-center gap-3 bg-olive-50 rounded-full py-2 px-4">
                        <img src="images/1.png" alt="User Avatar"
                            class="w-8 h-8 rounded-full border-2 border-olive-300">
                        <span class="font-medium text-olive-800" id="userName">Admin User</span>
                    </div>
                </div>
            </div>

            <!-- Dashboard -->
            <div id="dashboard" class="container mx-auto p-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div
                        class="stat-card bg-white rounded-xl shadow-soft p-6 flex flex-col items-center border border-olive-200">
                        <div class="bg-olive-100 p-3 rounded-full mb-4">
                            <i class="fas fa-users text-olive-700 text-xl"></i>
                        </div>
                        <h3 class="text-olive-600 mb-2 font-semibold" lang="en">Total Cadets</h3>
                        <h3 class="text-olive-600 mb-2 hidden font-semibold" lang="np">कुल क्याडेट</h3>
                        <p id="totalCadets" class="text-4xl font-extrabold text-olive-700">0</p>
                    </div>
                    <div
                        class="stat-card bg-white rounded-xl shadow-soft p-6 flex flex-col items-center border border-blue-100">
                        <div class="bg-blue-100 p-3 rounded-full mb-4">
                            <i class="fas fa-male text-blue-700 text-xl"></i>
                        </div>
                        <h3 class="text-blue-600 mb-2 font-semibold" lang="en">Male Cadets</h3>
                        <h3 class="text-blue-600 mb-2 hidden font-semibold" lang="np">पुरुष क्याडेट</h3>
                        <p id="maleCadets" class="text-4xl font-extrabold text-blue-700">0</p>
                    </div>
                    <div
                        class="stat-card bg-white rounded-xl shadow-soft p-6 flex flex-col items-center border border-pink-100">
                        <div class="bg-pink-100 p-3 rounded-full mb-4">
                            <i class="fas fa-female text-pink-700 text-xl"></i>
                        </div>
                        <h3 class="text-pink-600 mb-2 font-semibold" lang="en">Female Cadets</h3>
                        <h3 class="text-pink-600 mb-2 hidden font-semibold" lang="np">महिला क्याडेट</h3>
                        <p id="femaleCadets" class="text-4xl font-extrabold text-pink-700">0</p>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-white rounded-2xl shadow-soft p-6 mb-8">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-xl font-bold text-olive-800" lang="en">Recent Activity</h3>
                        <h3 class="text-xl font-bold text-olive-800 hidden" lang="np">हालको गतिविधि</h3>
                        <button class="text-olive-600 hover:text-olive-800">
                            <i class="fas fa-ellipsis-h"></i>
                        </button>
                    </div>
                    <div class="space-y-4">
                        <div class="flex items-start gap-3 pb-4 border-b border-olive-100">
                            <div class="bg-green-100 p-2 rounded-full mt-1">
                                <i class="fas fa-user-plus text-green-600"></i>
                            </div>
                            <div>
                                <p class="font-medium text-olive-800" lang="en">New cadet registered: <span
                                        class="font-semibold">John Doe</span></p>
                                <p class="font-medium text-olive-800 hidden" lang="np">नयाँ क्याडेट दर्ता: <span
                                        class="font-semibold">John Doe</span></p>
                                <p class="text-sm text-olive-500">2 hours ago</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-3 pb-4 border-b border-olive-100">
                            <div class="bg-blue-100 p-2 rounded-full mt-1">
                                <i class="fas fa-edit text-blue-600"></i>
                            </div>
                            <div>
                                <p class="font-medium text-olive-800" lang="en">Cadet information updated: <span
                                        class="font-semibold">Jane Smith</span></p>
                                <p class="font-medium text-olive-800 hidden" lang="np">क्याडेट जानकारी अपडेट: <span
                                        class="font-semibold">Jane Smith</span></p>
                                <p class="text-sm text-olive-500">Yesterday</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-3">
                            <div class="bg-purple-100 p-2 rounded-full mt-1">
                                <i class="fas fa-file-pdf text-purple-600"></i>
                            </div>
                            <div>
                                <p class="font-medium text-olive-800" lang="en">Report generated: Monthly Cadet Summary
                                </p>
                                <p class="font-medium text-olive-800 hidden" lang="np">रिपोर्ट जनरेट: मासिक क्याडेट
                                    सारांश</p>
                                <p class="text-sm text-olive-500">2 days ago</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-white rounded-2xl shadow-soft p-6">
                        <h3 class="text-xl font-bold text-olive-800 mb-4" lang="en">District Distribution</h3>
                        <h3 class="text-xl font-bold text-olive-800 mb-4 hidden" lang="np">जिल्ला वितरण</h3>
                        <div class="h-64 flex items-center justify-center">
                            <div class="text-center">
                                <div class="relative w-40 h-40 mx-auto mb-4">
                                    <div class="absolute inset-0 rounded-full border-8 border-olive-500"></div>
                                    <div class="absolute inset-8 rounded-full border-8 border-olive-300"></div>
                                    <div class="absolute inset-16 rounded-full border-8 border-olive-200"></div>
                                </div>
                                <p class="text-olive-600" lang="en">Top districts: Palpa, Rupandehi, Kapilvastu</p>
                                <p class="text-olive-600 hidden" lang="np">शीर्ष जिल्लाहरू: पाल्पा, रुपन्देही, कपिलवस्तु
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white rounded-2xl shadow-soft p-6">
                        <h3 class="text-xl font-bold text-olive-800 mb-4" lang="en">Rank Distribution</h3>
                        <h3 class="text-xl font-bold text-olive-800 mb-4 hidden" lang="np">पद वितरण</h3>
                        <div class="h-64 flex items-center justify-center">
                            <div class="w-full max-w-xs">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-olive-700">Cadet</span>
                                    <span class="font-bold text-olive-800">45%</span>
                                </div>
                                <div class="h-3 bg-olive-100 rounded-full mb-4">
                                    <div class="h-3 bg-olive-500 rounded-full" style="width: 45%"></div>
                                </div>

                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-olive-700">Corporal</span>
                                    <span class="font-bold text-olive-800">25%</span>
                                </div>
                                <div class="h-3 bg-olive-100 rounded-full mb-4">
                                    <div class="h-3 bg-olive-500 rounded-full" style="width: 25%"></div>
                                </div>

                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-olive-700">Sergeant</span>
                                    <span class="font-bold text-olive-800">15%</span>
                                </div>
                                <div class="h-3 bg-olive-100 rounded-full mb-4">
                                    <div class="h-3 bg-olive-500 rounded-full" style="width: 15%"></div>
                                </div>

                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-olive-700">SUO</span>
                                    <span class="font-bold text-olive-800">10%</span>
                                </div>
                                <div class="h-3 bg-olive-100 rounded-full">
                                    <div class="h-3 bg-olive-500 rounded-full" style="width: 10%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Add Cadet Form -->
            <div id="addCadet" class="container mx-auto p-6 hidden">
                <div class="bg-white rounded-2xl shadow-elevated p-8 max-w-4xl mx-auto border border-olive-200">
                    <div class="flex justify-between items-start mb-8">
                        <div>
                            <h2 class="text-2xl font-bold text-olive-800" lang="en">Add New Cadet</h2>
                            <h2 class="text-2xl font-bold text-olive-800 hidden" lang="np">नयाँ क्याडेट थप्नुहोस्</h2>
                            <p class="text-olive-600" lang="en">Fill in all required fields to register a new cadet</p>
                            <p class="text-olive-600 hidden" lang="np">नयाँ क्याडेट दर्ता गर्न सबै आवश्यक फिल्डहरू
                                भर्नुहोस्</p>
                        </div>
                        <button onclick="showScreen('dashboard')"
                            class="btn-secondary text-white px-4 py-2 rounded-lg font-semibold shadow transition flex items-center gap-2">
                            <i class="fas fa-arrow-left"></i>
                            <span lang="en">Back to Dashboard</span>
                            <span lang="np" class="hidden">ड्यासबोर्डमा फिर्ता जानुहोस्</span>
                        </button>
                    </div>
                    <form id="cadetForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Personal Details Card -->
                        <div class="md:col-span-2 bg-olive-50 rounded-xl p-6">
                            <h3 class="text-lg font-bold text-olive-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-user-circle"></i>
                                <span lang="en">Personal Details</span>
                                <span lang="np" class="hidden">व्यक्तिगत विवरण</span>
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Full Name -->
                                <div>
                                    <label class="block text-olive-700 mb-2 font-semibold" lang="en">Full Name</label>
                                    <label class="block text-olive-700 mb-2 hidden font-semibold" lang="np">पुरा
                                        नाम</label>
                                    <input type="text" name="name" required
                                        class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500">
                                </div>
                                <!-- Name in Nepali -->
                                <div>
                                    <label class="block text-olive-700 mb-2 font-semibold" lang="en">Name in
                                        Nepali</label>
                                    <label class="block text-olive-700 mb-2 hidden font-semibold" lang="np">नेपालीमा
                                        नाम</label>
                                    <input type="text" name="name_np" required
                                        class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500">
                                </div>
                                <!-- Rank -->
                                <div>
                                    <label class="block text-olive-700 mb-2 font-semibold" lang="en">Rank</label>
                                    <label class="block text-olive-700 mb-2 hidden font-semibold" lang="np">पद</label>
                                    <select name="rank" required
                                        class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500">
                                        <option value="Cadet">Cadet</option>
                                        <option value="Lance Corporal">Lance Corporal</option>
                                        <option value="Corporal">Corporal</option>
                                        <option value="Sergeant">Sergeant</option>
                                        <option value="Staff Sergeant">Staff Sergeant</option>
                                        <option value="PJUO">PJUO</option>
                                        <option value="CJUO">CJUO</option>
                                        <option value="SUO">SUO</option>
                                    </select>
                                </div>
                                <!-- Contact -->
                                <div>
                                    <label class="block text-olive-700 mb-2 font-semibold" lang="en">Contact</label>
                                    <label class="block text-olive-700 mb-2 hidden font-semibold"
                                        lang="np">सम्पर्क</label>
                                    <input type="text" name="contact" required
                                        class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500">
                                </div>
                                <!-- Address -->
                                <div>
                                    <label class="block text-olive-700 mb-2 font-semibold" lang="en">Address</label>
                                    <label class="block text-olive-700 mb-2 hidden font-semibold"
                                        lang="np">ठेगाना</label>
                                    <input type="text" name="address" required
                                        class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500">
                                </div>
                                <!-- Email -->
                                <div>
                                    <label class="block text-olive-700 mb-2 font-semibold" lang="en">Email</label>
                                    <label class="block text-olive-700 mb-2 hidden font-semibold" lang="np">इमेल</label>
                                    <input type="email" name="email" required
                                        class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500">
                                </div>
                                <!-- Gender -->
                                <div>
                                    <label class="block text-olive-700 mb-2 font-semibold" lang="en">Gender</label>
                                    <label class="block text-olive-700 mb-2 hidden font-semibold"
                                        lang="np">लिङ्ग</label>
                                    <select name="gender" required
                                        class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500">
                                        <option value="Male" lang="en">Male</option>
                                        <option value="Male" lang="np" class="hidden">पुरुष</option>
                                        <option value="Female" lang="en">Female</option>
                                        <option value="Female" lang="np" class="hidden">महिला</option>
                                        <option value="Other" lang="en">Other</option>
                                        <option value="Other" lang="np" class="hidden">अन्य</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Education Details Card -->
                        <div class="md:col-span-2 bg-olive-50 rounded-xl p-6">
                            <h3 class="text-lg font-bold text-olive-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-graduation-cap"></i>
                                <span lang="en">Education Details</span>
                                <span lang="np" class="hidden">शैक्षिक विवरण</span>
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- School Name -->
                                <div>
                                    <label class="block text-olive-700 mb-2 font-semibold" lang="en">School Name</label>
                                    <label class="block text-olive-700 mb-2 hidden font-semibold" lang="np">विद्यालयको
                                        नाम</label>
                                    <input type="text" name="school" required
                                        class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500">
                                </div>
                                <!-- NCC Batch -->
                                <div>
                                    <label class="block text-olive-700 mb-2 font-semibold" lang="en">NCC Batch</label>
                                    <label class="block text-olive-700 mb-2 hidden font-semibold" lang="np">NCC
                                        ब्याच</label>
                                    <input type="text" name="batch" required
                                        class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500">
                                </div>
                                <!-- Passout Year -->
                                <div>
                                    <label class="block text-olive-700 mb-2 font-semibold" lang="en">Passout
                                        Year</label>
                                    <label class="block text-olive-700 mb-2 hidden font-semibold" lang="np">पासआउट
                                        वर्ष</label>
                                    <input type="number" name="passout_year" required
                                        class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500">
                                </div>
                                <!-- District -->
                                <div>
                                    <label class="block text-olive-700 mb-2 font-semibold" lang="en">District</label>
                                    <label class="block text-olive-700 mb-2 hidden font-semibold"
                                        lang="np">जिल्ला</label>
                                    <select name="district" required
                                        class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500">
                                        <option value="Palpa" lang="en">Palpa</option>
                                        <option value="Palpa" lang="np" class="hidden">पाल्पा</option>
                                        <option value="Rupandehi" lang="en">Rupandehi</option>
                                        <option value="Rupandehi" lang="np" class="hidden">रुपन्देही</option>
                                        <option value="Arghakhanchi" lang="en">Arghakhanchi</option>
                                        <option value="Arghakhanchi" lang="np" class="hidden">अर्घाखाँची</option>
                                        <option value="Kapilvastu" lang="en">Kapilvastu</option>
                                        <option value="Kapilvastu" lang="np" class="hidden">कपिलवस्तु</option>
                                        <option value="Nawalparasi West" lang="en">Nawalparasi (West)</option>
                                        <option value="Nawalparasi West" lang="np" class="hidden">नवलपरासी (पश्चिम)
                                        </option>
                                        <option value="Gulmi" lang="en">Gulmi</option>
                                        <option value="Gulmi" lang="np" class="hidden">गुल्मी</option>
                                        <option value="Dang" lang="en">Dang</option>
                                        <option value="Dang" lang="np" class="hidden">दाङ</option>
                                        <option value="Pyuthan" lang="en">Pyuthan</option>
                                        <option value="Pyuthan" lang="np" class="hidden">प्यूठान</option>
                                        <option value="Rolpa" lang="en">Rolpa</option>
                                        <option value="Rolpa" lang="np" class="hidden">रोल्पा</option>
                                        <option value="Nawalparasi East" lang="en">Nawalparasi (East)</option>
                                        <option value="Nawalparasi East" lang="np" class="hidden">नवलपरासी (पूर्व)
                                        </option>
                                        <option value="Banke" lang="en">Banke</option>
                                        <option value="Banke" lang="np" class="hidden">बाँके</option>
                                        <option value="Bardiya" lang="en">Bardiya</option>
                                        <option value="Bardiya" lang="np" class="hidden">बर्दिया</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Guardian Details Card -->
                        <div class="md:col-span-2 bg-olive-50 rounded-xl p-6">
                            <h3 class="text-lg font-bold text-olive-800 mb-4 flex items-center gap-2">
                                <i class="fas fa-user-friends"></i>
                                <span lang="en">Guardian Details</span>
                                <span lang="np" class="hidden">अभिभावक विवरण</span>
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <!-- Guardian Name -->
                                <div>
                                    <label class="block text-olive-700 mb-2 font-semibold" lang="en">Guardian
                                        Name</label>
                                    <label class="block text-olive-700 mb-2 hidden font-semibold" lang="np">अभिभावकको
                                        नाम</label>
                                    <input type="text" name="guardian_name" required
                                        class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500">
                                </div>
                                <!-- Guardian Contact -->
                                <div>
                                    <label class="block text-olive-700 mb-2 font-semibold" lang="en">Guardian
                                        Contact</label>
                                    <label class="block text-olive-700 mb-2 hidden font-semibold" lang="np">अभिभावक
                                        सम्पर्क</label>
                                    <input type="text" name="guardian_contact" required
                                        class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500">
                                </div>
                                <!-- Relation -->
                                <div>
                                    <label class="block text-olive-700 mb-2 font-semibold" lang="en">Relation</label>
                                    <label class="block text-olive-700 mb-2 hidden font-semibold"
                                        lang="np">सम्बन्ध</label>
                                    <input type="text" name="relation" required
                                        class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500">
                                </div>
                            </div>
                        </div>

                        <!-- Timestamp (hidden, auto-filled) -->
                        <input type="hidden" name="timestamp" id="timestamp">
                        <div class="md:col-span-2 mt-6 flex justify-center">
                            <button type="submit"
                                class="btn-primary text-white px-8 py-3 rounded-xl font-bold shadow-lg transition flex items-center gap-2">
                                <i class="fas fa-user-plus"></i>
                                <span lang="en">Register Cadet</span>
                                <span lang="np" class="hidden">क्याडेट दर्ता गर्नुहोस्</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- View Cadets -->
            <div id="viewCadets" class="container mx-auto p-6 hidden">
                <div class="bg-white rounded-2xl shadow-elevated p-8 max-w-6xl mx-auto border border-olive-200">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h2 class="text-2xl font-bold text-olive-800" lang="en">Cadet List</h2>
                            <h2 class="text-2xl font-bold text-olive-800 hidden" lang="np">क्याडेट सूची</h2>
                            <p class="text-olive-600" lang="en">All registered cadets in the system</p>
                            <p class="text-olive-600 hidden" lang="np">प्रणालीमा दर्ता भएका सबै क्याडेटहरू</p>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="showScreen('dashboard')"
                                class="btn-secondary text-white px-4 py-2 rounded-lg font-semibold shadow transition flex items-center gap-2">
                                <i class="fas fa-arrow-left"></i>
                                <span lang="en">Back</span>
                                <span lang="np" class="hidden">फिर्ता</span>
                            </button>
                            <button
                                class="btn-primary text-white px-4 py-2 rounded-lg font-semibold shadow transition flex items-center gap-2">
                                <i class="fas fa-download"></i>
                                <span lang="en">Export</span>
                                <span lang="np" class="hidden">निर्यात गर्नुहोस्</span>
                            </button>
                        </div>
                    </div>

                    <div class="flex flex-col md:flex-row justify-between gap-4 mb-6">
                        <div class="relative w-full md:w-64">
                            <input type="text" id="searchInput" placeholder="Search cadets..."
                                class="w-full pl-10 pr-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500">
                            <i class="fas fa-search absolute left-3 top-3 text-olive-500"></i>
                        </div>
                        <div class="flex gap-3">
                            <select
                                class="px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500">
                                <option>All Districts</option>
                                <option>Palpa</option>
                                <option>Rupandehi</option>
                                <option>Kapilvastu</option>
                            </select>
                            <select
                                class="px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500">
                                <option>All Ranks</option>
                                <option>Cadet</option>
                                <option>Corporal</option>
                                <option>Sergeant</option>
                                <option>SUO</option>
                            </select>
                        </div>
                    </div>

                    <div class="overflow-x-auto rounded-xl shadow-sm border border-olive-200">
                        <table class="min-w-full bg-white">
                            <thead>
                                <tr class="bg-olive-100 text-olive-700">
                                    <th class="py-4 px-6 text-left font-semibold">ID</th>
                                    <th class="py-4 px-6 text-left font-semibold">Name</th>
                                    <th class="py-4 px-6 text-left font-semibold">Rank</th>
                                    <th class="py-4 px-6 text-left font-semibold">Contact</th>
                                    <th class="py-4 px-6 text-left font-semibold">Gender</th>
                                    <th class="py-4 px-6 text-left font-semibold">School</th>
                                    <th class="py-4 px-6 text-left font-semibold">District</th>
                                    <th class="py-4 px-6 text-left font-semibold">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="cadetTableBody" class="divide-y divide-olive-100">

                            </tbody>
                        </table>
                    </div>

                    <div class="flex justify-between items-center mt-6">
                        <div class="text-olive-600">
                            <span lang="en">Showing 1 to 3 of 15 entries</span>
                            <span lang="np" class="hidden">१ देखि ३ सम्म १५ प्रविष्टिहरू देखाइएको छ</span>
                        </div>
                        <div class="flex gap-2">
                            <button
                                class="px-4 py-2 border border-olive-300 rounded-lg text-olive-700 hover:bg-olive-50">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="px-4 py-2 bg-olive-700 text-white rounded-lg font-semibold">1</button>
                            <button
                                class="px-4 py-2 border border-olive-300 rounded-lg text-olive-700 hover:bg-olive-50">2</button>
                            <button
                                class="px-4 py-2 border border-olive-300 rounded-lg text-olive-700 hover:bg-olive-50">3</button>
                            <button
                                class="px-4 py-2 border border-olive-300 rounded-lg text-olive-700 hover:bg-olive-50">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Military-style Cadet View Modal -->
            <div id="cadetModal"
                class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[9999] hidden">
                <div
                    class="bg-white rounded-2xl shadow-elevated border-4 border-olive-700 max-w-xl w-full relative p-8">
                    <button id="closeCadetModal"
                        class="absolute top-4 right-4 text-olive-700 hover:text-red-600 text-xl font-bold">
                        <i class="fas fa-times"></i>
                    </button>
                    <div class="flex items-center gap-6 mb-6">
                        <div
                            class="bg-olive-200 rounded-full border-4 border-olive-700 p-4 flex items-center justify-center">
                            <i class="fas fa-user-shield text-olive-700 text-5xl"></i>
                        </div>
                        <div>
                            <h2 id="cadetModalName" class="text-2xl font-extrabold text-olive-800 mb-1 tracking-tight">
                            </h2>
                            <span id="cadetModalRank"
                                class="inline-block bg-olive-700 text-black-700 font-bold px-4 py-1 rounded-full text-sm shadow border border-olive-900">
                                <!-- Rank will be injected here -->
                            </span>
                            <span id="cadetModalDistrict"
                                class="inline-block bg-olive-100 text-olive-700 px-3 py-1 rounded-full font-semibold text-sm ml-2 shadow border border-olive-300">District</span>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-olive-700 font-medium">
                        <div><strong>Contact:</strong> <span id="cadetModalContact"></span></div>
                        <div><strong>Gender:</strong> <span id="cadetModalGender"></span></div>
                        <div><strong>School:</strong> <span id="cadetModalSchool"></span></div>
                        <div><strong>Batch:</strong> <span id="cadetModalBatch"></span></div>
                        <div><strong>Passout Year:</strong> <span id="cadetModalPassout"></span></div>
                        <div><strong>Email:</strong> <span id="cadetModalEmail"></span></div>
                        <div><strong>Address:</strong> <span id="cadetModalAddress"></span></div>
                    </div>
                    <div class="mt-6 border-t pt-4">
                        <h3 class="text-lg font-bold text-olive-800 mb-2 flex items-center gap-2">
                            <i class="fas fa-user-shield"></i> Guardian Details
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-olive-700 font-medium">
                            <div><strong>Name:</strong> <span id="cadetModalGuardianName"></span></div>
                            <div><strong>Contact:</strong> <span id="cadetModalGuardianContact"></span></div>
                            <div><strong>Relation:</strong> <span id="cadetModalRelation"></span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Edit Cadet Modal -->
            <div id="editCadetModal"
                class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-[9999] hidden">
                <div
                    class="bg-white rounded-2xl shadow-elevated border-4 border-olive-700 max-w-2xl w-full relative p-8">
                    <button id="closeEditCadetModal"
                        class="absolute top-4 right-4 text-olive-700 hover:text-red-600 text-xl font-bold">
                        <i class="fas fa-times"></i>
                    </button>
                    <h2 class="text-2xl font-bold text-olive-800 mb-6 flex items-center gap-2">
                        <i class="fas fa-user-edit"></i>
                        Edit Cadet
                    </h2>
                    <form id="editCadetForm" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-olive-700 mb-2 font-semibold">Full Name</label>
                            <input type="text" name="name" id="editName"
                                class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500"
                                required>
                        </div>
                        <div>
                            <label class="block text-olive-700 mb-2 font-semibold">Rank</label>
                            <select name="rank" id="editRank"
                                class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500"
                                required>
                                <option value="Cadet">Cadet</option>
                                <option value="Lance Corporal">Lance Corporal</option>
                                <option value="Corporal">Corporal</option>
                                <option value="Sergeant">Sergeant</option>
                                <option value="Staff Sergeant">Staff Sergeant</option>
                                <option value="PJUO">PJUO</option>
                                <option value="CJUO">CJUO</option>
                                <option value="SUO">SUO</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-olive-700 mb-2 font-semibold">Contact</label>
                            <input type="text" name="contact" id="editContact"
                                class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500"
                                required>
                        </div>
                        <div>
                            <label class="block text-olive-700 mb-2 font-semibold">Gender</label>
                            <select name="gender" id="editGender"
                                class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500"
                                required>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-olive-700 mb-2 font-semibold">School Name</label>
                            <input type="text" name="school" id="editSchool"
                                class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500"
                                required>
                        </div>
                        <div>
                            <label class="block text-olive-700 mb-2 font-semibold">Batch</label>
                            <input type="text" name="batch" id="editBatch"
                                class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500"
                                required>
                        </div>
                        <div>
                            <label class="block text-olive-700 mb-2 font-semibold">Passout Year</label>
                            <input type="number" name="passout_year" id="editPassoutYear"
                                class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500"
                                required>
                        </div>
                        <div>
                            <label class="block text-olive-700 mb-2 font-semibold">District</label>
                            <select name="district" id="editDistrict"
                                class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500"
                                required>
                                <option value="Palpa">Palpa</option>
                                <option value="Rupandehi">Rupandehi</option>
                                <option value="Arghakhanchi">Arghakhanchi</option>
                                <option value="Kapilvastu">Kapilvastu</option>
                                <option value="Nawalparasi West">Nawalparasi (West)</option>
                                <option value="Gulmi">Gulmi</option>
                                <option value="Dang">Dang</option>
                                <option value="Pyuthan">Pyuthan</option>
                                <option value="Rolpa">Rolpa</option>
                                <option value="Nawalparasi East">Nawalparasi (East)</option>
                                <option value="Banke">Banke</option>
                                <option value="Bardiya">Bardiya</option>
                            </select>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-olive-700 mb-2 font-semibold">Address</label>
                            <input type="text" name="address" id="editAddress"
                                class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500"
                                required>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-olive-700 mb-2 font-semibold">Email</label>
                            <input type="email" name="email" id="editEmail"
                                class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500"
                                required>
                        </div>
                        <div class="md:col-span-2">
                            <label class="block text-olive-700 mb-2 font-semibold">Guardian Name</label>
                            <input type="text" name="guardian_name" id="editGuardianName"
                                class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500"
                                required>
                        </div>
                        <div>
                            <label class="block text-olive-700 mb-2 font-semibold">Guardian Contact</label>
                            <input type="text" name="guardian_contact" id="editGuardianContact"
                                class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500"
                                required>
                        </div>
                        <div>
                            <label class="block text-olive-700 mb-2 font-semibold">Relation</label>
                            <input type="text" name="relation" id="editRelation"
                                class="w-full px-4 py-2 border border-olive-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-olive-500"
                                required>
                        </div>
                        <input type="hidden" name="timestamp" id="editTimestamp">
                        <input type="hidden" name="original_contact" id="editOriginalContact">
                        <div class="md:col-span-2 mt-6 flex justify-center">
                            <button type="submit"
                                class="btn-primary text-white px-8 py-3 rounded-xl font-bold shadow-lg transition flex items-center gap-2">
                                <i class="fas fa-save"></i>
                                Save Changes
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Loader -->
    <div id="loader" class="fixed inset-0 bg-olive-900 bg-opacity-40 flex items-center justify-center hidden z-50">
        <div class="loader ease-linear rounded-full border-4 border-t-4 border-olive-400 h-16 w-16"></div>
    </div>

    <script>
        // Configuration
        const APP_URL = 'https://script.google.com/macros/s/AKfycbyU7ZcmN2avRhL6t8aTwSo8LQAc2kt2HlIqh7aHrMZWT1TkWF0vpgQ4k4E1Uv7j2Ugw/exec';
        const ALLOWED_EMAIL = 'nccaalumbini@gmail.com';
        let currentUser = null;
        let isSidebarCollapsed = false;
        let currentScreen = 'dashboard';

        // Language switching
        function switchLanguage(lang) {
            document.querySelectorAll('[lang]').forEach(el => {
                el.classList.toggle('hidden', el.lang !== lang);
            });
        }

        // Navigation functions
        function showScreen(screenId) {
            currentScreen = screenId;
            document.querySelectorAll('#app > div').forEach(el => {
                el.classList.toggle('hidden', el.id !== screenId);
            });

            const titles = {
                'dashboard': { en: 'Dashboard', np: 'ड्यासबोर्ड' },
                'addCadet': { en: 'Add Cadet', np: 'क्याडेट थप्नुहोस्' },
                'viewCadets': { en: 'View Cadets', np: 'क्याडेट सूची' },
                'reports': { en: 'Reports', np: 'रिपोर्टहरू' },
                'settings': { en: 'Settings', np: 'सेटिङहरू' }
            };

            const titleEl = document.getElementById('screenTitle');
            if (titleEl) {
                titleEl.textContent = titles[screenId].en;
                if (titleEl.nextElementSibling) {
                    titleEl.nextElementSibling.textContent = titles[screenId].np;
                }
            }

            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`button[onclick="showScreen('${screenId}')"]`).classList.add('active');

            // Close mobile sidebar
            document.getElementById('sidebar').classList.remove('open');

            if (screenId === 'viewCadets') {
                loadCadetTable();
            }
        }

        // Toggle sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const app = document.getElementById('app');
            isSidebarCollapsed = !isSidebarCollapsed;

            if (isSidebarCollapsed) {
                sidebar.classList.add('sidebar-collapsed');
                sidebar.classList.remove('w-64');
                sidebar.classList.add('w-20');
                app.classList.remove('ml-64');
                app.classList.add('ml-20');
                // Hide logo text and nav-text
                sidebar.querySelector('.text-lg').classList.add('hidden');
                sidebar.querySelectorAll('.nav-text').forEach(el => el.classList.add('hidden'));
                sidebar.querySelectorAll('.lang-text, .logout-text').forEach(el => el.classList.add('hidden'));
                sidebar.querySelectorAll('.lang-btn, .logout-btn').forEach(el => el.classList.add('justify-center'));
                sidebar.querySelector('.sidebar-footer').classList.add('items-center');
                document.getElementById('sidebarToggle').innerHTML = '<i class="fas fa-chevron-right"></i>';
            } else {
                sidebar.classList.remove('sidebar-collapsed');
                sidebar.classList.remove('w-20');
                sidebar.classList.add('w-64');
                app.classList.remove('ml-20');
                app.classList.add('ml-64');
                sidebar.querySelector('.text-lg').classList.remove('hidden');
                sidebar.querySelectorAll('.nav-text').forEach(el => el.classList.remove('hidden'));
                sidebar.querySelectorAll('.lang-text, .logout-text').forEach(el => el.classList.remove('hidden'));
                sidebar.querySelectorAll('.lang-btn, .logout-btn').forEach(el => el.classList.remove('justify-center'));
                sidebar.querySelector('.sidebar-footer').classList.remove('items-center');
                document.getElementById('sidebarToggle').innerHTML = '<i class="fas fa-chevron-left"></i>';
            }
        }

        // Loader
        function showLoader() {
            document.getElementById('loader').classList.remove('hidden');
        }
        function hideLoader() {
            document.getElementById('loader').classList.add('hidden');
        }

        // Logout
        function logout() {
            sessionStorage.removeItem('nccaa_user');
            google.accounts.id.disableAutoSelect();
            location.reload();
        }

        // Search Cadets
        function searchCadets() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            document.querySelectorAll('#cadetTableBody tr').forEach(row => {
                row.style.display = row.textContent.toLowerCase().includes(query) ? '' : 'none';
            });
        }
        document.getElementById('searchInput').addEventListener('input', searchCadets);

        // Google Sign-In
        function handleLogin(response) {
            showLoader();
            const payload = JSON.parse(atob(response.credential.split('.')[1]));
            if (payload.email === ALLOWED_EMAIL) {
                currentUser = payload;
                sessionStorage.setItem('nccaa_user', JSON.stringify(payload));
                document.getElementById('userName').textContent = payload.name;
                showApp();
                loadDashboardStats();
            } else {
                alert('Access restricted to NCCAA administrators only');
                google.accounts.id.disableAutoSelect();
            }
            hideLoader();
        }

        // Form submission
        document.getElementById('cadetForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            showLoader();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            try {
                const response = await fetch(APP_URL, {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                if (result.success) {
                    alert('Cadet registered successfully!');
                    e.target.reset();
                    loadDashboardStats();
                    showScreen('dashboard');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Registration failed. Please try again.');
            }
            hideLoader();
        });

        // Dashboard stats
        async function loadDashboardStats() {
            showLoader();
            try {
                const response = await fetch(`${APP_URL}?action=stats`);
                const result = await response.json();
                if (result.success) {
                    document.getElementById('totalCadets').textContent = result.stats.total;
                    document.getElementById('maleCadets').textContent = result.stats.male;
                    document.getElementById('femaleCadets').textContent = result.stats.female;
                }
            } catch (error) {
                console.error('Error loading stats:', error);
            }
            hideLoader();
        }

        async function loadCadetTable() {
            showLoader();
            try {
                // Get all districts
                const districtsRes = await fetch(`${APP_URL}?action=districts`);
                const districtsData = await districtsRes.json();
                let allCadets = [];
                for (const district of districtsData.districts) {
                    const cadetRes = await fetch(`${APP_URL}?action=cadets&district=${encodeURIComponent(district)}`);
                    const cadetData = await cadetRes.json();
                    if (cadetData.success) {
                        allCadets = allCadets.concat(cadetData.cadets.map(cadet => ({
                            ...cadet,
                            District: district
                        })));
                    }
                }
                renderCadetTable(allCadets);
            } catch (error) {
                console.error('Error loading cadets:', error);
            }
            hideLoader();
        }

        function renderCadetTable(cadets) {
            const tbody = document.getElementById('cadetTableBody');
            tbody.innerHTML = '';
            cadets.forEach((cadet, idx) => {
                // Use timestamp + district as unique ID
                const cadetId = `${cadet.Timestamp}_${cadet.District}`;
                tbody.innerHTML += `
            <tr>
                <td class="py-4 px-6">C${idx + 1}</td>
                <td class="py-4 px-6 font-medium">${cadet.Name}</td>
                <td class="py-4 px-6"><span class="bg-olive-100 text-olive-800 px-3 py-1 rounded-full text-sm">${cadet.Rank}</span></td>
                <td class="py-4 px-6">${cadet.Contact}</td>
                <td class="py-4 px-6">${cadet.Gender}</td>
                <td class="py-4 px-6">${cadet['School Name']}</td>
                <td class="py-4 px-6">${cadet.District}</td>
                <td class="py-4 px-6">
                    <div class="flex gap-2">
                        <button class="text-blue-600 hover:text-blue-800" onclick="viewCadet('${cadetId}')"><i class="fas fa-eye"></i></button>
                        <button class="text-olive-600 hover:text-olive-800" onclick="editCadet('${cadetId}')"><i class="fas fa-edit"></i></button>
                        <button class="text-red-600 hover:text-red-800" onclick="deleteCadet('${cadetId}')"><i class="fas fa-trash-alt"></i></button>
                    </div>
                </td>
            </tr>
        `;
            });
            window.cadetList = cadets; // Store for later use
        }

        function showModal(cadet) {
            // Fill modal fields
            document.getElementById('cadetModalName').textContent = cadet.Name || '';
            document.getElementById('cadetModalRank').textContent = cadet.Rank || '';
            document.getElementById('cadetModalDistrict').textContent = cadet.District || '';
            document.getElementById('cadetModalContact').textContent = cadet.Contact || '';
            document.getElementById('cadetModalGender').textContent = cadet.Gender || '';
            document.getElementById('cadetModalSchool').textContent = cadet['School Name'] || '';
            document.getElementById('cadetModalBatch').textContent = cadet['NCC Batch'] || '';
            document.getElementById('cadetModalPassout').textContent = cadet['Passout Year'] || '';
            document.getElementById('cadetModalEmail').textContent = cadet.Email || '';
            document.getElementById('cadetModalAddress').textContent = cadet.Address || '';
            document.getElementById('cadetModalGuardianName').textContent = cadet['Guardian Name'] || '';
            document.getElementById('cadetModalGuardianContact').textContent = cadet['Guardian Contact'] || '';
            document.getElementById('cadetModalRelation').textContent = cadet.Relation || '';
            document.getElementById('cadetModal').classList.remove('hidden');
        }

        // Close modal logic
        document.getElementById('closeCadetModal').addEventListener('click', () => {
            document.getElementById('cadetModal').classList.add('hidden');
        });
        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') document.getElementById('cadetModal').classList.add('hidden');
        });

        // Update viewCadet to use showModal
        function viewCadet(cadetId) {
            const cadet = window.cadetList.find(c => `${c.Timestamp}_${c.District}` === cadetId);
            if (!cadet) return;
            showModal(cadet);
        }

        // Initialize app
        function showApp() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('appContainer').classList.remove('hidden');
            switchLanguage('en'); // Default language
            showScreen('dashboard');
        }

        // Check session on load
        window.addEventListener('DOMContentLoaded', () => {
            const savedUser = sessionStorage.getItem('nccaa_user');
            if (savedUser && JSON.parse(savedUser).email === ALLOWED_EMAIL) {
                currentUser = JSON.parse(savedUser);
                document.getElementById('userName').textContent = currentUser.name;
                showApp();
                loadDashboardStats();
            }

            // Set up event listeners
            document.getElementById('sidebarToggle').addEventListener('click', toggleSidebar);
            document.getElementById('mobileMenuBtn').addEventListener('click', () => {
                document.getElementById('sidebar').classList.toggle('open');
            });

            // Auto logout when tab closes
            window.addEventListener('beforeunload', () => {
                sessionStorage.removeItem('nccaa_user');
            });
        });

        function doPost(e) {
            return ContentService
                .createTextOutput(JSON.stringify({ success: true }))
                .setMimeType(ContentService.MimeType.JSON)
                .setHeader("Access-Control-Allow-Origin", "*");
        }

        function editCadet(cadetId) {
            const cadet = window.cadetList.find(c => `${c.Timestamp}_${c.District}` === cadetId);
            if (!cadet) return;
            document.getElementById('editName').value = cadet.Name || '';
            document.getElementById('editRank').value = cadet.Rank || '';
            document.getElementById('editContact').value = cadet.Contact || '';
            document.getElementById('editGender').value = cadet.Gender || '';
            document.getElementById('editSchool').value = cadet['School Name'] || '';
            document.getElementById('editBatch').value = cadet['NCC Batch'] || '';
            document.getElementById('editPassoutYear').value = cadet['Passout Year'] || '';
            document.getElementById('editDistrict').value = cadet.District || '';
            document.getElementById('editAddress').value = cadet.Address || '';
            document.getElementById('editEmail').value = cadet.Email || '';
            document.getElementById('editGuardianName').value = cadet['Guardian Name'] || '';
            document.getElementById('editGuardianContact').value = cadet['Guardian Contact'] || '';
            document.getElementById('editRelation').value = cadet.Relation || '';
            document.getElementById('editTimestamp').value = cadet.Timestamp || '';
            document.getElementById('editOriginalContact').value = cadet.Contact || '';
            document.getElementById('editCadetModal').classList.remove('hidden');
        }

        document.getElementById('closeEditCadetModal').addEventListener('click', () => {
            document.getElementById('editCadetModal').classList.add('hidden');
        });
        window.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') document.getElementById('editCadetModal').classList.add('hidden');
        });

        // Handle edit form submission (add your update logic here)
        document.getElementById('editCadetForm').addEventListener('submit', async function (e) {
            e.preventDefault();
            showLoader();
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            data.action = "edit"; // Specify edit action for backend

            try {
                const response = await fetch(APP_URL, {
                    method: 'POST',
                    body: JSON.stringify(data)
                });
                const result = await response.json();
                if (result.success) {
                    alert('Cadet updated successfully!');
                    document.getElementById('editCadetModal').classList.add('hidden');
                    loadCadetTable(); // Refresh table
                } else {
                    alert('Update failed: ' + (result.error || 'Unknown error'));
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Update failed. Please try again.');
            }
            hideLoader();
        });
    </script>
</body>

</html>